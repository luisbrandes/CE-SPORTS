{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/eumig/CE-SPORTS/web/app/%28app%29/campeonatos/historico-partidas/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState, useMemo } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { Card } from \"@/components/card\";\r\nimport { Button } from \"@/components/button\";\r\n\r\ntype ApiEquipe = {\r\n  id?: number;\r\n  nome?: string;\r\n};\r\n\r\ntype ApiCampeonato = {\r\n  id?: number;\r\n  nome?: string;\r\n};\r\n\r\ntype ApiPartidaRaw = {\r\n  id?: number;\r\n  campeonato?: ApiCampeonato | string;\r\n  equipe1?: ApiEquipe | string;\r\n  equipe2?: ApiEquipe | string;\r\n  pontuacao1?: number | string | null;\r\n  pontuacao2?: number | string | null;\r\n  empate?: boolean;\r\n  vencedor?: ApiEquipe | string | null;\r\n  data?: string | null;\r\n  // outros campos possíveis...\r\n};\r\n\r\nexport default function PartidasPage() {\r\n  const [partidas, setPartidas] = useState<ApiPartidaRaw[] | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const normalizeName = (\r\n    value: ApiEquipe | ApiCampeonato | string | undefined | null\r\n  ) => {\r\n    if (!value) return \"-\";\r\n    if (typeof value === \"string\") return value;\r\n    return (value as any).nome ?? \"-\";\r\n  };\r\n\r\n  // garante que pontuações venham como number | null\r\n  const normalizeScore = (\r\n    val: number | string | undefined | null\r\n  ): number | null => {\r\n    if (val === null || val === undefined) return null;\r\n    if (typeof val === \"number\") return val;\r\n    const n = Number(val);\r\n    return Number.isNaN(n) ? null : n;\r\n  };\r\n\r\n  const fetchPartidas = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n    setPartidas(null);\r\n    const candidates = [\"/api/partida\", \"/api/partidas\", \"/api/partida/all\"];\r\n    let lastError: any = null;\r\n\r\n    for (const url of candidates) {\r\n      try {\r\n        const res = await fetch(url, { method: \"GET\", cache: \"no-store\" });\r\n        if (!res.ok) {\r\n          lastError = `endpoint ${url} retornou ${res.status}`;\r\n          continue;\r\n        }\r\n        const json = await res.json();\r\n        const arr = Array.isArray(json)\r\n          ? json\r\n          : json?.data ?? json?.content ?? json?.partidas ?? null;\r\n        if (!arr || !Array.isArray(arr)) {\r\n          lastError = `endpoint ${url} retornou formato inesperado`;\r\n          continue;\r\n        }\r\n        // Normalize scores in place to keep consistent types\r\n        const normalized = arr.map((p: ApiPartidaRaw) => ({\r\n          ...p,\r\n          pontuacao1: normalizeScore(p.pontuacao1 as any),\r\n          pontuacao2: normalizeScore(p.pontuacao2 as any),\r\n        }));\r\n        setPartidas(normalized);\r\n        setLoading(false);\r\n        return;\r\n      } catch (e) {\r\n        lastError = e;\r\n      }\r\n    }\r\n\r\n    setLoading(false);\r\n    setError(\r\n      `Não foi possível obter partidas: ${\r\n        typeof lastError === \"string\"\r\n          ? lastError\r\n          : (lastError && lastError.message) || \"erro desconhecido\"\r\n      }. Verifique o endpoint da API.`\r\n    );\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchPartidas();\r\n  }, []);\r\n\r\n  // mock quick test\r\n  const MOCK_PARTIDAS: ApiPartidaRaw[] = [\r\n    {\r\n      id: 1,\r\n      campeonato: { id: 1, nome: \"Copa Caloura 2025\" },\r\n      equipe1: { id: 1, nome: \"Informática\" },\r\n      equipe2: { id: 2, nome: \"Eletrotécnica\" },\r\n      pontuacao1: 3,\r\n      pontuacao2: 2,\r\n      empate: false,\r\n      vencedor: { id: 1, nome: \"Informática\" },\r\n      data: \"2025-04-15T14:00:00\",\r\n    },\r\n    {\r\n      id: 2,\r\n      campeonato: \"Interturmas 2025\",\r\n      equipe1: \"Mecânica\",\r\n      equipe2: \"Edificações\",\r\n      pontuacao1: 1,\r\n      pontuacao2: 1,\r\n      empate: true,\r\n      vencedor: null,\r\n      data: \"2025-04-20T16:00:00\",\r\n    },\r\n  ];\r\n\r\n  // Ordena partidas: mais recente primeiro. Prioriza campo `data` (ISO), depois id desc.\r\n  const sortedPartidas = useMemo(() => {\r\n    if (!partidas) return null;\r\n    return [...partidas].sort((a, b) => {\r\n      const aDate = a.data ? Date.parse(a.data) : NaN;\r\n      const bDate = b.data ? Date.parse(b.data) : NaN;\r\n      if (!Number.isNaN(aDate) && !Number.isNaN(bDate)) return bDate - aDate;\r\n      if (!Number.isNaN(aDate)) return -1;\r\n      if (!Number.isNaN(bDate)) return 1;\r\n      const aId = a.id ?? 0;\r\n      const bId = b.id ?? 0;\r\n      return bId - aId;\r\n    });\r\n  }, [partidas]);\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background text-foreground py-8\">\r\n      <div className=\"container mx-auto px-4\">\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <div>\r\n            <h1 className=\"text-2xl font-bold text-black\">\r\n              Histórico de Partidas\r\n            </h1>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              Lista das partidas registradas no sistema\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <Link href=\"/campeonatos\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"border-blue-600 text-blue-600 hover:bg-blue-50\"\r\n              >\r\n                ← Voltar para Campeonatos\r\n              </Button>\r\n            </Link>\r\n\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => {\r\n                fetchPartidas();\r\n              }}\r\n            >\r\n              Refresh\r\n            </Button>\r\n\r\n            <Link href=\"/registrar-partida\">\r\n              <Button variant=\"primary\" size=\"sm\">\r\n                ➕ Nova Partida\r\n              </Button>\r\n            </Link>\r\n          </div>\r\n        </div>\r\n\r\n        <Card className=\"p-4\">\r\n          {loading && (\r\n            <div className=\"py-8 text-center\">Carregando partidas...</div>\r\n          )}\r\n\r\n          {!loading && error && (\r\n            <div className=\"py-6\">\r\n              <div className=\"text-red-600 mb-2\">Erro: {error}</div>\r\n              <div className=\"text-sm text-muted-foreground mb-4\">\r\n                Se a API não estiver pronta, você pode usar dados mock:\r\n              </div>\r\n              <div className=\"flex gap-2\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  onClick={() => setPartidas(MOCK_PARTIDAS)}\r\n                >\r\n                  Usar dados de exemplo\r\n                </Button>\r\n                <Button variant=\"outline\" onClick={() => fetchPartidas()}>\r\n                  Tentar novamente\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && sortedPartidas && sortedPartidas.length === 0 && (\r\n            <div className=\"py-8 text-center text-muted-foreground\">\r\n              Nenhuma partida encontrada.\r\n            </div>\r\n          )}\r\n\r\n          {!loading && sortedPartidas && sortedPartidas.length > 0 && (\r\n            <div className=\"overflow-x-auto\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"bg-blue-600 text-white\">\r\n                  <tr>\r\n                    <th className=\"p-2 text-left\">#</th>\r\n                    <th className=\"p-2 text-left\">Campeonato</th>\r\n                    <th className=\"p-2 text-left\">Equipe 1</th>\r\n                    <th className=\"p-2 text-left\">Equipe 2</th>\r\n                    <th className=\"p-2 text-left\">Placar</th>\r\n                    <th className=\"p-2 text-left\">Resultado</th>\r\n                    <th className=\"p-2 text-left\">Data</th>\r\n                  </tr>\r\n                </thead>\r\n\r\n                <tbody>\r\n                  {sortedPartidas.map((p, idx) => {\r\n                    const camp = normalizeName(p.campeonato);\r\n                    const e1 = normalizeName(p.equipe1);\r\n                    const e2 = normalizeName(p.equipe2);\r\n\r\n                    // pegamos números normalizados (ou null)\r\n                    const g1 =\r\n                      p.pontuacao1 === null || p.pontuacao1 === undefined\r\n                        ? null\r\n                        : Number(p.pontuacao1);\r\n                    const g2 =\r\n                      p.pontuacao2 === null || p.pontuacao2 === undefined\r\n                        ? null\r\n                        : Number(p.pontuacao2);\r\n\r\n                    // lógica do placar: se ambos null => \"Pendente\"\r\n                    // se algum null => mostra \"-\" para esse lado\r\n                    const left = g1 === null ? \"-\" : String(g1);\r\n                    const right = g2 === null ? \"-\" : String(g2);\r\n                    const placarDisplay =\r\n                      g1 === null && g2 === null\r\n                        ? \"Pendente\"\r\n                        : `${left} × ${right}`;\r\n\r\n                    let resultado = \"-\";\r\n                    if (p.empate) resultado = \"Empate\";\r\n                    else if (p.vencedor) resultado = normalizeName(p.vencedor);\r\n                    else if (typeof g1 === \"number\" && typeof g2 === \"number\") {\r\n                      if (g1 > g2) resultado = e1;\r\n                      else if (g2 > g1) resultado = e2;\r\n                      else resultado = \"—\";\r\n                    } else if (g1 === null && g2 === null) {\r\n                      resultado = \"-\";\r\n                    } else {\r\n                      resultado = \"-\"; // indeciso quando um dos placares falta\r\n                    }\r\n\r\n                    const dataStr = p.data\r\n                      ? new Date(p.data).toLocaleString(\"pt-BR\")\r\n                      : \"-\";\r\n\r\n                    return (\r\n                      <tr\r\n                        key={p.id ?? idx}\r\n                        className=\"border-t border-border hover:bg-muted/30 transition\"\r\n                      >\r\n                        <td className=\"p-2\">{p.id ?? idx + 1}</td>\r\n                        <td className=\"p-2 text-black\">{camp}</td>\r\n                        <td className=\"p-2\">{e1}</td>\r\n                        <td className=\"p-2\">{e2}</td>\r\n                        <td className=\"p-2 font-medium\">{placarDisplay}</td>\r\n                        <td className=\"p-2\">{resultado}</td>\r\n                        <td className=\"p-2\">{dataStr}</td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}